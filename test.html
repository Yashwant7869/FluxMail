<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SheetMailEngine Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ SheetMailEngine Test Page</h1>
        
        <div class="section">
            <h2>üìä Server Status</h2>
            <button onclick="checkServer()">Check Server Status</button>
            <div id="serverStatus" class="result"></div>
        </div>

        <div class="section">
            <h2>üìã Google Sheets Integration</h2>
            <input type="text" id="sheetId" placeholder="Enter Google Sheets ID" value="1AisQECPgjCKHEzkQi8_2KopfZSG_rlCxAYNNtTXSv24">
            <button onclick="importContacts()">Import Contacts</button>
            <button onclick="getContacts()">View All Contacts</button>
            <div id="contactsResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üìß Email Campaign</h2>
            <input type="text" id="campaignName" placeholder="Campaign Name" value="Test Campaign">
            <input type="text" id="subject" placeholder="Email Subject" value="Hello {{name}}!">
            <textarea id="content" placeholder="Email Content" rows="4">
Hello {{name}},

Welcome to our service! We're excited to have {{email}} in our community.

Best regards,
Team
            </textarea>
            <input type="text" id="fromName" placeholder="From Name" value="Test Sender">
            <input type="email" id="fromEmail" placeholder="From Email" value="test@example.com">
            <button onclick="createCampaign()">Create Campaign</button>
            <button onclick="getCampaigns()">View All Campaigns</button>
            <div id="campaignResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üìà Statistics</h2>
            <button onclick="getStats()">Get Stats</button>
            <div id="statsResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        async function makeRequest(url, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (data) options.body = JSON.stringify(data);
                
                const response = await fetch(url, options);
                const result = await response.json();
                return { success: response.ok, data: result };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function checkServer() {
            const result = await makeRequest(`${API_BASE}/stats`);
            const div = document.getElementById('serverStatus');
            if (result.success) {
                div.className = 'result success';
                div.innerHTML = `‚úÖ Server is running! Stats: ${JSON.stringify(result.data)}`;
            } else {
                div.className = 'result error';
                div.innerHTML = `‚ùå Server error: ${result.error}`;
            }
        }

        async function importContacts() {
            const sheetId = document.getElementById('sheetId').value;
            if (!sheetId) {
                alert('Please enter a Google Sheets ID');
                return;
            }

            const result = await makeRequest(`${API_BASE}/sheets/${sheetId}/import`, 'POST', {
                emailColumn: 0,
                nameColumn: 1,
                range: 'A:Z'
            });

            const div = document.getElementById('contactsResult');
            if (result.success) {
                div.className = 'result success';
                div.innerHTML = `‚úÖ Contacts imported successfully! ${JSON.stringify(result.data)}`;
            } else {
                div.className = 'result error';
                div.innerHTML = `‚ùå Import failed: ${result.error || JSON.stringify(result.data)}`;
            }
        }

        async function getContacts() {
            const result = await makeRequest(`${API_BASE}/contacts`);
            const div = document.getElementById('contactsResult');
            if (result.success) {
                div.className = 'result success';
                div.innerHTML = `üìã Contacts (${result.data.length}): <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                div.className = 'result error';
                div.innerHTML = `‚ùå Failed to get contacts: ${result.error}`;
            }
        }

        async function createCampaign() {
            const data = {
                name: document.getElementById('campaignName').value,
                subject: document.getElementById('subject').value,
                content: document.getElementById('content').value,
                fromName: document.getElementById('fromName').value,
                fromEmail: document.getElementById('fromEmail').value
            };

            const result = await makeRequest(`${API_BASE}/campaigns`, 'POST', data);
            const div = document.getElementById('campaignResult');
            if (result.success) {
                div.className = 'result success';
                div.innerHTML = `‚úÖ Campaign created! ID: ${result.data.id}`;
            } else {
                div.className = 'result error';
                div.innerHTML = `‚ùå Failed to create campaign: ${result.error || JSON.stringify(result.data)}`;
            }
        }

        async function getCampaigns() {
            const result = await makeRequest(`${API_BASE}/campaigns`);
            const div = document.getElementById('campaignResult');
            if (result.success) {
                div.className = 'result success';
                div.innerHTML = `üìß Campaigns (${result.data.length}): <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                div.className = 'result error';
                div.innerHTML = `‚ùå Failed to get campaigns: ${result.error}`;
            }
        }

        async function getStats() {
            const result = await makeRequest(`${API_BASE}/stats`);
            const div = document.getElementById('statsResult');
            if (result.success) {
                div.className = 'result success';
                div.innerHTML = `üìà Statistics: <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                div.className = 'result error';
                div.innerHTML = `‚ùå Failed to get stats: ${result.error}`;
            }
        }

        // Auto-check server status on page load
        window.onload = () => checkServer();
    </script>
</body>
</html>